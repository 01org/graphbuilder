<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GraphBuilder 2.0 (alpha): com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacecom.html">com</a>::<a class="el" href="namespacecom_1_1intel.html">intel</a>::<a class="el" href="namespacecom_1_1intel_1_1hadoop.html">hadoop</a>::<a class="el" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder.html">graphbuilder</a>::<a class="el" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline.html">pipeline</a>::<a class="el" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output.html">output</a>::<a class="el" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan.html">titan</a>::<a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1IntermediateEdgeWriterReducer.html">IntermediateEdgeWriterReducer</a>
  </div>
</div>
<div class="contents">
<h1>com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer Class Reference</h1><!-- doxytag: class="com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer" --><!-- doxytag: inherits="org::apache::hadoop::mapreduce::Reducer" -->
<p>Inherits org::apache::hadoop::mapreduce::Reducer&lt; IntWritable, SerializedGraphElement, IntWritable, SerializedGraphElement &gt;.</p>

<p><a href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1IntermediateEdgeWriterReducer-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1IntermediateEdgeWriterReducer.html#a34d4ea6e5ac0faada856758388aa5e83">setup</a> (Context context)  throws IOException,             InterruptedException </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1IntermediateEdgeWriterReducer.html#a47491e7cd8c84bc6c6c36db27bf9f1b0">reduce</a> (IntWritable key, Iterable&lt; SerializedGraphElement &gt; values, Context context)  throws IOException, InterruptedException </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">Enum&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1IntermediateEdgeWriterReducer.html#a9cc133787799004df87e82b888cb7e94">getEdgeCounter</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">Enum&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1pipeline_1_1output_1_1titan_1_1IntermediateEdgeWriterReducer.html#ae0494f1c18cb51a82b398c3ae512724f">getEdgePropertiesCounter</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Write edges with Titan vertex ID of the target vertex to HDFS. </p>
<p>This class gathers each vertex with the edges that point to that vertex, that is, those edges for which the vertex is the destination. Because the edges were tagged with the Titan IDs of their sources in the previous Map Reduce job and each vertex is tagged with its Titan ID, we now know the Titan ID of the source and destination of the edges and can add them to Titan.  </p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a9cc133787799004df87e82b888cb7e94"></a><!-- doxytag: member="com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer::getEdgeCounter" ref="a9cc133787799004df87e82b888cb7e94" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Enum com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer::getEdgeCounter </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00202"></a>00202                                  {
<a name="l00203"></a>00203         <span class="keywordflow">return</span> Counters.NUM_EDGES;
<a name="l00204"></a>00204     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae0494f1c18cb51a82b398c3ae512724f"></a><!-- doxytag: member="com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer::getEdgePropertiesCounter" ref="ae0494f1c18cb51a82b398c3ae512724f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Enum com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer::getEdgePropertiesCounter </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><div class="fragment"><pre class="fragment"><a name="l00206"></a>00206                                           {
<a name="l00207"></a>00207         <span class="keywordflow">return</span> Counters.EDGE_PROPERTIES_WRITTEN;
<a name="l00208"></a>00208     }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47491e7cd8c84bc6c6c36db27bf9f1b0"></a><!-- doxytag: member="com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer::reduce" ref="a47491e7cd8c84bc6c6c36db27bf9f1b0" args="(IntWritable key, Iterable&lt; SerializedGraphElement &gt; values, Context context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer::reduce </td>
          <td>(</td>
          <td class="paramtype">IntWritable&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Iterable&lt; SerializedGraphElement &gt;&nbsp;</td>
          <td class="paramname"> <em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Context&nbsp;</td>
          <td class="paramname"> <em>context</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td>  throws IOException, InterruptedException <code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This routine is called by Hadoop to write edges to an intermediate HDFS location </p>
<p>We assume that the edges and vertices have been gathered so that every edge shares the reducer of its destination vertex, and that every edge has previously been assigned the Titan ID of its source vertex.  </p>
<p>Titan IDs are propagated from the destination vertices to each edge  </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>@code</em>&nbsp;</td><td>key  A map reduce key; a hash of a vertex ID. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>@code</em>&nbsp;</td><td>values  Either a vertex with that hashed vertex ID, or an edge with said vertex as its destination. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>@code</em>&nbsp;</td><td>context  A reducer context provided by Hadoop. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>IOException</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>InterruptedException</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00145"></a>00145                                                      {
<a name="l00146"></a>00146 
<a name="l00147"></a>00147         Hashtable&lt;EdgeID, Writable&gt; edgePropertyTable  = <span class="keyword">new</span> Hashtable();
<a name="l00148"></a>00148 
<a name="l00149"></a>00149         <span class="keywordflow">for</span>(SerializedGraphElement graphElement: values){
<a name="l00150"></a>00150             <span class="comment">/*</span>
<a name="l00151"></a>00151 <span class="comment">             * This is calling IntermediateEdgeWriterReducerCallback which is an</span>
<a name="l00152"></a>00152 <span class="comment">             * implementation of GraphElementTypeCallback to add all the</span>
<a name="l00153"></a>00153 <span class="comment">             * edges and vertices into  the edgePropertyTable and</span>
<a name="l00154"></a>00154 <span class="comment">             * vertexNameToTitanID hashmaps</span>
<a name="l00155"></a>00155 <span class="comment">             */</span>
<a name="l00156"></a>00156             graphElement.graphElement().typeCallback(
<a name="l00157"></a>00157                     intermediateEdgeWriterReducerCallback,
<a name="l00158"></a>00158                     ArgumentBuilder.newArguments()
<a name="l00159"></a>00159                             .with(<span class="stringliteral">&quot;edgePropertyTable&quot;</span>, edgePropertyTable)
<a name="l00160"></a>00160                             .with(<span class="stringliteral">&quot;vertexNameToTitanID&quot;</span>,
<a name="l00161"></a>00161                     vertexNameToTitanID));
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         <span class="keywordtype">int</span> edgeCount   = 0;
<a name="l00165"></a>00165         <a class="code" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1types_1_1StringType.html">StringType</a> edgeLabel = <span class="keyword">new</span> <a class="code" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1types_1_1StringType.html">StringType</a>();
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         <span class="comment">// Output edge records</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169         <span class="keywordflow">for</span> (Map.Entry&lt;EdgeID, Writable&gt; edgeMapEntry :
<a name="l00170"></a>00170                     edgePropertyTable.entrySet()) {
<a name="l00171"></a>00171 
<a name="l00172"></a>00172             VertexID&lt;StringType&gt; srcVertexId = (VertexID&lt;StringType&gt;)
<a name="l00173"></a>00173                     edgeMapEntry.getKey().getSrc();
<a name="l00174"></a>00174             VertexID&lt;StringType&gt; tgtVertexId = (VertexID&lt;StringType&gt;)
<a name="l00175"></a>00175                     edgeMapEntry.getKey().getDst();
<a name="l00176"></a>00176             edgeLabel.<a class="code" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1types_1_1StringType.html#ab6a4644d2c0fbc7e9282261b38e37b0d">set</a>(edgeMapEntry.getKey().getLabel().toString());
<a name="l00177"></a>00177             PropertyMap propertyMap = (PropertyMap) edgeMapEntry.getValue();
<a name="l00178"></a>00178 
<a name="l00179"></a>00179             Edge tempEdge = <span class="keyword">new</span> Edge();
<a name="l00180"></a>00180             tempEdge.configure(srcVertexId, tgtVertexId, edgeLabel, propertyMap);
<a name="l00181"></a>00181 
<a name="l00182"></a>00182             <span class="comment">// Add the Titan ID of the target vertex</span>
<a name="l00183"></a>00183 
<a name="l00184"></a>00184             <span class="keywordtype">long</span> dstTitanId
<a name="l00185"></a>00185                     = vertexNameToTitanID.get(edgeMapEntry.getKey().getDst());
<a name="l00186"></a>00186             tempEdge.setProperty(<span class="stringliteral">&quot;tgtTitanID&quot;</span>, <span class="keyword">new</span> <a class="code" href="classcom_1_1intel_1_1hadoop_1_1graphbuilder_1_1types_1_1LongType.html">LongType</a>(dstTitanId));
<a name="l00187"></a>00187 
<a name="l00188"></a>00188             outValue.init(tempEdge);
<a name="l00189"></a>00189             outKey.set(keyFunction.getEdgeKey(tempEdge));
<a name="l00190"></a>00190 
<a name="l00191"></a>00191             context.write(outKey, outValue);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193             tempEdge = null;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195             edgeCount++;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197          }  <span class="comment">// End of for loop on edges</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         context.getCounter(Counters.NUM_EDGES).increment(edgeCount);
<a name="l00200"></a>00200     }   <span class="comment">// End of reduce</span>
</pre></div></p>

</div>
</div>
<a class="anchor" id="a34d4ea6e5ac0faada856758388aa5e83"></a><!-- doxytag: member="com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer::setup" ref="a34d4ea6e5ac0faada856758388aa5e83" args="(Context context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void com::intel::hadoop::graphbuilder::pipeline::output::titan::IntermediateEdgeWriterReducer::setup </td>
          <td>(</td>
          <td class="paramtype">Context&nbsp;</td>
          <td class="paramname"> <em>context</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td>  throws IOException,             InterruptedException <code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets up the Titan connection.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>@code</em>&nbsp;</td><td>context  The reducer context provided by Hadoop. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>IOException</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>InterruptedException</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p><div class="fragment"><pre class="fragment"><a name="l00098"></a>00098                                  {
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         this.vertexNameToTitanID = <span class="keyword">new</span> Hashtable&lt;Object, Long&gt;();
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         intermediateEdgeWriterReducerCallback = <span class="keyword">new</span> IntermediateEdgeWriterReducerCallback();
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         outClass = context.getMapOutputValueClass();
<a name="l00105"></a>00105         outKey   = <span class="keyword">new</span> IntWritable();
<a name="l00106"></a>00106 
<a name="l00107"></a>00107         <span class="keywordflow">try</span> {
<a name="l00108"></a>00108             outValue   = (SerializedGraphElement) outClass.newInstance();
<a name="l00109"></a>00109         } <span class="keywordflow">catch</span> (InstantiationException e) {
<a name="l00110"></a>00110             GraphBuilderExit.graphbuilderFatalExitException(<a class="code" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder_1_1util.html#a4935bb7e652e5c54bbe426d8e728b12c">StatusCode</a>
<a name="l00111"></a>00111                     .CLASS_INSTANTIATION_ERROR, <span class="stringliteral">&quot;GRAPHBUILDER_ERROR: Cannot &quot;</span> +
<a name="l00112"></a>00112                     <span class="stringliteral">&quot;instantiate new reducer output value ( &quot;</span> + outClass
<a name="l00113"></a>00113                     .getName() + <span class="stringliteral">&quot;)&quot;</span>, LOG, e);
<a name="l00114"></a>00114         } <span class="keywordflow">catch</span> (IllegalAccessException e) {
<a name="l00115"></a>00115             GraphBuilderExit.graphbuilderFatalExitException(<a class="code" href="namespacecom_1_1intel_1_1hadoop_1_1graphbuilder_1_1util.html#a4935bb7e652e5c54bbe426d8e728b12c">StatusCode</a>
<a name="l00116"></a>00116                     .CLASS_INSTANTIATION_ERROR, <span class="stringliteral">&quot;GRAPHBUILDER_ERROR: Illegal &quot;</span> +
<a name="l00117"></a>00117                     <span class="stringliteral">&quot;access exception when instantiating reducer output value&quot;</span> +
<a name="l00118"></a>00118                     <span class="stringliteral">&quot; ( &quot;</span> + outClass.getName() + <span class="stringliteral">&quot;)&quot;</span>, LOG, e);
<a name="l00119"></a>00119         }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     }
</pre></div></p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/main/java/com/intel/hadoop/graphbuilder/pipeline/output/titan/<a class="el" href="IntermediateEdgeWriterReducer_8java.html">IntermediateEdgeWriterReducer.java</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 26 Dec 2013 for GraphBuilder 2.0 (alpha) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
